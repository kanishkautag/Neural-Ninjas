<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Course Recommendations</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.12.0/cdn.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
  <link rel="stylesheet" href="./output.css" class="css" />
  <style>
    .gradient-bg {
      background: linear-gradient(120deg, #1a202c 0%, #2d3748 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3),
        0 10px 10px -5px rgba(0, 0, 0, 0.2);
    }
    .modal-backdrop {
      backdrop-filter: blur(5px);
    }
    .dropdown-animation {
      animation: fadeInDown 0.5s ease forwards;
    }
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .course-card {
      animation: fadeIn 0.6s ease forwards;
      opacity: 0;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .course-card:nth-child(1) {
      animation-delay: 0.1s;
    }
    .course-card:nth-child(2) {
      animation-delay: 0.2s;
    }
    .course-card:nth-child(3) {
      animation-delay: 0.3s;
    }
    .loading-spinner {
      border-top-color: #667eea;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen" x-data="courseApp()">
  <!-- Initial Category Modal -->
  <div
    x-show="showCategoryModal"
    class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop bg-black bg-opacity-60"
    x-transition
  >
    <div
      class="bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full border border-gray-700 dropdown-animation"
    >
      <h2
        class="text-2xl font-bold mb-6 text-center bg-gradient-to-r from-purple-400 to-blue-500 bg-clip-text text-transparent"
      >
        Choose Your Interest
      </h2>
      <p class="mb-6 text-gray-300">
        Select a category to discover personalized course recommendations that match your
        interests.
      </p>
      <div class="space-y-3">
        <button
          @click="selectCategory('business')"
          class="w-full py-3 px-4 rounded-lg bg-gradient-to-r from-indigo-600 to-indigo-800 hover:from-indigo-500 hover:to-indigo-700 flex items-center justify-between transition duration-300"
        >
          <span>Business & Finance</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        <button
          @click="selectCategory('design')"
          class="w-full py-3 px-4 rounded-lg bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 flex items-center justify-between transition duration-300"
        >
          <span>Graphic Design</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        <button
          @click="selectCategory('music')"
          class="w-full py-3 px-4 rounded-lg bg-gradient-to-r from-pink-600 to-pink-800 hover:from-pink-500 hover:to-pink-700 flex items-center justify-between transition duration-300"
        >
          <span>Musical Instruments</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        <button
          @click="selectCategory('webdev')"
          class="w-full py-3 px-4 rounded-lg bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 flex items-center justify-between transition duration-300"
        >
          <span>Web Development</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Level Selection Modal -->
  <div
    x-show="showLevelModal"
    class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop bg-black bg-opacity-60"
    x-transition
  >
    <div
      class="bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full border border-gray-700 dropdown-animation"
    >
      <h2
        class="text-2xl font-bold mb-6 text-center bg-gradient-to-r from-purple-400 to-blue-500 bg-clip-text text-transparent"
      >
        Choose Experience Level
      </h2>
      <p class="mb-6 text-gray-300">
        Select your experience level for
        <span class="font-bold" x-text="getCategoryText()"></span> courses:
      </p>
      <div class="space-y-3">
        <template x-for="level in availableLevels" :key="level">
          <button
            @click="selectLevel(level)"
            class="w-full py-3 px-4 rounded-lg bg-gradient-to-r from-indigo-600 to-indigo-800 hover:from-indigo-500 hover:to-indigo-700 flex items-center justify-between transition duration-300"
          >
            <span x-text="level"></span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </template>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div
    x-show="loading"
    class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop bg-black bg-opacity-70"
  >
    <div class="text-center">
      <div
        class="inline-block h-12 w-12 border-4 border-gray-600 rounded-full loading-spinner animate-spin"
      ></div>
      <p class="mt-4 text-lg">Loading recommendations...</p>
    </div>
  </div>

  <!-- Error Modal -->
  <div
    x-show="showErrorModal"
    class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop bg-black bg-opacity-60"
    x-transition
  >
    <div
      class="bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full border border-gray-700 dropdown-animation"
    >
      <h2 class="text-2xl font-bold mb-6 text-center text-red-500">Error</h2>
      <p class="mb-6 text-gray-300" x-text="errorMessage"></p>
      <div class="flex justify-center">
        <button
          @click="showErrorModal = false; showCategoryModal = true"
          class="py-2 px-4 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition duration-300"
        >
          Try Again
        </button>
      </div>
    </div>
  </div>

  <!-- Main Page Content -->
  <header class="gradient-bg py-8 relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-purple-900/40 to-blue-900/40"></div>
    <div class="container mx-auto px-4 relative">
      <nav class="bg-gray-800 py-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-xl font-bold">Developer Network</div>
            <div class="flex items-center space-x-4">
                <a href="home.html" class="hover:text-blue-400">Home</a>
                <a href="profile.html" class="hover:text-blue-400">Profile</a>
                <a href="job_openings.html" class="text-blue-400 font-semibold">Job Openings</a>
                <button
          @click="showCategoryModal = true"
          class="py-2 px-4 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center space-x-2 border border-gray-700 transition duration-300"
        >
          <span>Change Interest</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </button> 
                <button id="logout-button" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">Logout</button>
            </div>
        </div>
    </nav>
        
      <div class="text-center">
        <h1
          class="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 via-blue-400 to-indigo-400 bg-clip-text text-transparent"
        >
          Course Recommendations
        </h1>
        <p class="text-xl text-gray-300" x-text="getHeaderText()"></p>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-12">
    <!-- No Recommendations Message -->
    <div
      x-show="apiCourses.length === 0 && !loading && selectedCategory"
      class="text-center py-12"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-16 w-16 mx-auto text-gray-600 mb-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <h3 class="text-xl font-semibold mb-2">No courses found</h3>
      <p class="text-gray-400 mb-6">
        We couldn't find any courses matching your criteria.
      </p>
      <button
        @click="showCategoryModal = true"
        class="py-2 px-4 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition duration-300"
      >
        Try Different Criteria
      </button>
    </div>

    <!-- Courses Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <template x-for="(course, index) in apiCourses" :key="course.course_id">
        <div
          class="bg-gray-800 rounded-xl overflow-hidden shadow-lg card-hover border border-gray-700 course-card"
        >
          <div class="h-48 overflow-hidden relative">
            <div class="absolute inset-0 bg-gray-900/50 z-10"></div>
            <img
              src="/api/placeholder/600/400"
              alt="Course thumbnail"
              class="w-full h-full object-cover"
            />
            <div
              class="absolute top-4 right-4 bg-indigo-600 text-white text-xs font-bold px-3 py-1 rounded-full z-20"
              x-text="course.level"
            ></div>
          </div>
          <div class="p-6">
            <div class="flex items-center mb-4">
              <span
                class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300"
                x-text="course.subject"
              ></span>
              <div class="ml-auto flex">
                <template x-for="i in 5">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    :class="i <= Math.min(Math.round(course.num_reviews / 1000) + 3, 5) ? 'text-yellow-400' : 'text-gray-600'"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                    />
                  </svg>
                </template>
              </div>
            </div>
            <h3 class="text-xl font-bold mb-2" x-text="course.course_title"></h3>
            <p class="text-gray-400 mb-4 text-sm">
              <span x-text="`${course.num_subscribers.toLocaleString()} students enrolled`"></span>
              <span
                x-show="course.num_reviews > 0"
                x-text="` • ${course.num_reviews.toLocaleString()} reviews`"
              ></span>
            </p>
            <div class="flex items-center justify-between">
              <span class="text-xl font-bold text-indigo-400" x-text="'$' + course.price"></span>
              <a
                :href="course.url"
                target="_blank"
                class="py-2 px-4 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition duration-300"
                >View Course</a
              >
            </div>
          </div>
        </div>
      </template>
    </div>
  </main>

  <footer class="bg-gray-800 py-8 mt-12 border-t border-gray-700">
    <div class="container mx-auto px-4 text-center text-gray-400">
      <p>© 2025 CourseHub. All rights reserved.</p>
    </div>
  </footer>

  <script>
    function courseApp() {
      return {
        showCategoryModal: true,
        showLevelModal: false,
        showErrorModal: false,
        loading: false,
        errorMessage: "",
        selectedCategory: "",
        selectedLevel: "",
        selectedSubject: "",
        apiCourses: [],
        availableLevels: [],
        // Category to subject mapping
        categorySubjectMap: {
          business: "Business Finance",
          design: "Graphic Design",
          music: "Musical Instruments",
          webdev: "Web Development",
        },
        // Initialize: Load API data
        init() {
          // You can load available levels here if needed
          this.fetchLevels();
        },
        // Fetch available levels from API
        async fetchLevels() {
          try {
            const response = await fetch("http://127.0.0.1:8080/api/courses/levels");
            if (!response.ok) throw new Error("Failed to load course levels");
            const data = await response.json();
            this.availableLevels = data.levels;
          } catch (error) {
            console.error("Error fetching levels:", error);
            this.availableLevels = ["Beginner", "Intermediate", "Advanced", "All Levels"];
          }
        },
        // Select category and show level modal
        selectCategory(category) {
          this.selectedCategory = category;
          this.selectedSubject = this.categorySubjectMap[category];
          this.showCategoryModal = false;
          this.showLevelModal = true;
        },
        // Select level and fetch courses
        selectLevel(level) {
          this.selectedLevel = level;
          this.showLevelModal = false;
          this.fetchCourses();
        },
        // Fetch courses from API (fixed endpoint to match backend)
        async fetchCourses() {
          this.loading = true;
          try {
            const response = await fetch(
              `http://127.0.0.1:8080/api/courses/recommend?level=${encodeURIComponent(
                this.selectedLevel
              )}&subject=${encodeURIComponent(this.selectedSubject)}&limit=9`
            );
    
            if (!response.ok) {
              const error = await response.json();
              throw new Error(error.detail || "Failed to fetch course recommendations");
            }
    
            const data = await response.json();
            this.apiCourses = data.recommendations;
    
            // If no courses found, show a message
            if (this.apiCourses.length === 0) {
              console.log("No courses found for the selected criteria");
            }
          } catch (error) {
            console.error("Error fetching courses:", error);
            this.errorMessage =
              error.message || "Failed to load course recommendations. Please try again.";
            this.showErrorModal = true;
          } finally {
            this.loading = false;
          }
        },
        // Get header text based on selected category and level
        getHeaderText() {
          if (!this.selectedCategory) return "Select a category to get started";
          if (!this.selectedLevel) return `Choose your experience level`;
    
          const categoryText = {
            business: "Business & Finance",
            design: "Graphic Design",
            music: "Musical Instruments",
            webdev: "Web Development",
          };
    
          return `${this.selectedLevel} ${categoryText[this.selectedCategory] || ""} Courses`;
        },
        // Get category text for level modal
        getCategoryText() {
          const categoryText = {
            business: "Business & Finance",
            design: "Graphic Design",
            music: "Musical Instruments",
            webdev: "Web Development",
          };
    
          return categoryText[this.selectedCategory] || "";
        },
      };
    }
  </script>
</body>
</html>