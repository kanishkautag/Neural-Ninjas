<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-800 text-white">
    <nav class="bg-gray-900 py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="text-xl font-bold">Developer Network</div>
            <div class="flex items-center space-x-4">
                <img id="navbar-profile-img" src="default-profile.jpg" alt="Profile" class="w-8 h-8 rounded-full">
                <span id="navbar-username">User</span>
                <button id="logout-button" class="bg-red-600 px-4 py-2 rounded-md hover:bg-red-700 transition-colors">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-gray-900 rounded-lg shadow-lg p-6">
            <!-- View Mode -->
            <div id="view-mode" class="space-y-6">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold">Profile</h1>
                    <button id="edit-button" class="bg-blue-600 px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                        Edit Profile
                    </button>
                </div>

                <div class="flex space-x-6">
                    <div class="w-32">
                        <img id="profile-image" src="default-profile.jpg" alt="Profile Image" class="w-full h-32 object-cover rounded-lg">
                    </div>
                    <div class="flex-1 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Name</label>
                            <div class="flex space-x-2">
                                <div id="firstname" class="p-3 bg-gray-700 rounded-md border border-gray-600 flex-1">John</div>
                                <div id="lastname" class="p-3 bg-gray-700 rounded-md border border-gray-600 flex-1">Doe</div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                            <div id="email" class="p-3 bg-gray-700 rounded-md border border-gray-600">john.doe@example.com</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Preferred Location</label>
                            <div id="location" class="p-3 bg-gray-700 rounded-md border border-gray-600">Not specified</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Industry</label>
                            <div id="industry" class="p-3 bg-gray-700 rounded-md border border-gray-600">Not specified</div>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Skills</label>
                    <div id="skills-display" class="p-3 bg-gray-700 rounded-md border border-gray-600 min-h-[100px]">None selected</div>
                </div>
            </div>

            <!-- Edit Mode -->
            <div id="edit-mode" class="hidden space-y-6">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold">Edit Profile</h1>
                    <button id="cancel-button" class="bg-gray-600 px-4 py-2 rounded-md hover:bg-gray-700 transition-colors">
                        Cancel
                    </button>
                </div>

                <div class="flex space-x-6">
                    <div class="w-32 space-y-2">
                        <img id="edit-profile-image" src="default-profile.jpg" alt="Profile Image" class="w-full h-32 object-cover rounded-lg">
                        <button id="change-image-button" class="w-full bg-gray-700 px-2 py-1 rounded-md text-sm hover:bg-gray-600 transition-colors">
                            Change Image
                        </button>
                        <button id="remove-image-button" class="w-full bg-red-700 px-2 py-1 rounded-md text-sm hover:bg-red-600 transition-colors">
                            Remove Image
                        </button>
                        <input type="file" id="profile-image-input" class="hidden" accept="image/*">
                    </div>
                    <div class="flex-1 space-y-4">
                        <div>
                            <label for="edit-firstname" class="block text-sm font-medium text-gray-300 mb-1">First Name</label>
                            <input type="text" id="edit-firstname" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                        </div>
                        <div>
                            <label for="edit-lastname" class="block text-sm font-medium text-gray-300 mb-1">Last Name</label>
                            <input type="text" id="edit-lastname" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                        </div>
                        <div>
                            <label for="edit-location" class="block text-sm font-medium text-gray-300 mb-1">Preferred Location (optional)</label>
                            <input type="text" id="edit-location" placeholder="e.g. Remote, New York, London" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                        </div>
                    </div>
                </div>

                <div>
                    <label for="edit-industry" class="block text-sm font-medium text-gray-300 mb-1">Industry</label>
                    <select id="edit-industry" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                        <option value="">Select your industry</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Skills</label>
                    <div id="skills-container" class="flex flex-wrap gap-2 p-3 bg-gray-700 rounded-md border border-gray-600 min-h-[100px]">
                        <!-- Skills will be populated by JavaScript based on selected industry -->
                    </div>
                </div>

                <div>
                    <label for="custom-skill" class="block text-sm font-medium text-gray-300 mb-1">Add Custom Skill</label>
                    <div class="flex gap-2">
                        <input type="text" id="custom-skill" placeholder="Enter a skill not listed above" 
                          class="flex-grow p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                        <button id="add-custom-skill" 
                          class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors">
                          Add
                        </button>
                    </div>
                    <div id="custom-skills-container" class="flex flex-wrap gap-2 mt-3"></div>
                </div>

                <div class="pt-4">
                    <button id="save-button" class="w-full bg-green-600 py-3 rounded-md hover:bg-green-700 transition-colors font-medium">
                        Save Profile
                    </button>
                    <p id="save-message" class="mt-2 text-gray-400 text-center italic"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyCkcLCqyAGP9HOUjPIx8Sg75-uVbh3_HmQ",
            authDomain: "signup-d66c5.firebaseapp.com",
            databaseURL: "https://signup-d66c5-default-rtdb.firebaseio.com",
            projectId: "signup-d66c5",
            storageBucket: "signup-d66c5.appspot.com",
            messagingSenderId: "847953931653",
            appId: "1:847953931653:web:41d05ae9d308af716fe8ec",
            measurementId: "G-Q2BSPWWNHX"
        };
        
        // Initialize Firebase
        var app = firebase.initializeApp(firebaseConfig);

        // First, let's add the industry categories and their associated skills
       // Enhanced industry categories and their associated skills
const industrySkills = {
  "Web Development": [
    "HTML", "CSS", "JavaScript", "TypeScript", "React", "Angular", "Vue.js",
    "Node.js", "Express", "PHP", "Laravel", "WordPress", "SEO", "Responsive Design",
    "Web Accessibility", "Performance Optimization", "SSR", "JAMstack"
  ],
  "Mobile Development": [
    "iOS", "Swift", "SwiftUI", "Android", "Kotlin", "Java", "React Native", 
    "Flutter", "Xamarin", "Mobile UI/UX", "App Store Optimization", "Push Notifications",
    "Offline Storage", "Mobile Security", "Mobile Performance"
  ],
  "Data Science": [
    "Python", "R", "SQL", "Machine Learning", "Deep Learning", "TensorFlow", "PyTorch",
    "Data Visualization", "Pandas", "NumPy", "Scikit-learn", "Statistics", "Big Data",
    "Data Mining", "Natural Language Processing", "Computer Vision"
  ],
  "DevOps": [
    "AWS", "Azure", "Google Cloud", "Docker", "Kubernetes", "Jenkins", "CI/CD",
    "Terraform", "Ansible", "Prometheus", "Grafana", "Linux", "Shell Scripting",
    "Infrastructure as Code", "Site Reliability Engineering", "Monitoring"
  ],
  "Cybersecurity": [
    "Network Security", "Ethical Hacking", "Penetration Testing", "OWASP", "Cryptography",
    "Security Auditing", "Threat Modeling", "Identity Management", "Secure Coding",
    "Incident Response", "Digital Forensics", "Security Compliance", "SIEM"
  ],
  "UI/UX Design": [
    "Figma", "Sketch", "Adobe XD", "Photoshop", "Illustrator", "Wireframing",
    "Prototyping", "User Research", "Usability Testing", "Accessibility Design",
    "Interaction Design", "Information Architecture", "Visual Design"
  ],
  "Healthcare": [
    "Clinical Practice", "Patient Care", "Medical Records", "HIPAA Compliance", 
    "Medical Terminology", "Healthcare Informatics", "Electronic Health Records",
    "Medical Coding", "Medical Billing", "Patient Advocacy", "Clinical Research",
    "Pharmaceutical Knowledge", "Medical Devices", "Telemedicine", "Healthcare Administration"
  ],
  "Hospitality & Tourism": [
    "Hotel Management", "Food & Beverage Service", "Event Planning", "Reservation Systems",
    "Customer Service", "Revenue Management", "Housekeeping Operations", "Front Desk Operations",
    "Hospitality Marketing", "Tourism Management", "Travel Coordination", "Concierge Services",
    "Restaurant Management", "Catering", "Hotel Property Management Systems"
  ],
  "Finance & Accounting": [
    "Financial Analysis", "Bookkeeping", "Tax Preparation", "Financial Reporting",
    "Budgeting", "Forecasting", "Risk Assessment", "Audit", "Financial Statements",
    "QuickBooks", "SAP", "Excel Modeling", "Financial Planning", "Investment Analysis",
    "Banking Services", "Payroll Processing", "Accounts Receivable/Payable"
  ],
  "Marketing & Communications": [
    "Digital Marketing", "Content Marketing", "Social Media Management", "SEO/SEM",
    "Brand Development", "Market Research", "Email Marketing", "Public Relations",
    "Campaign Management", "Google Analytics", "CRM Management", "Copywriting",
    "Marketing Automation", "Data-Driven Marketing", "Influencer Marketing"
  ],
  "Education": [
    "Curriculum Development", "Instructional Design", "Educational Technology",
    "Classroom Management", "Learning Assessment", "E-Learning", "Special Education",
    "Student Counseling", "Education Administration", "LMS Administration",
    "Educational Research", "Teaching Methodologies", "Student Engagement"
  ],
  "Legal": [
    "Legal Research", "Contract Law", "Corporate Law", "Intellectual Property",
    "Litigation", "Compliance", "Legal Writing", "Case Management", "Legal Ethics",
    "Negotiations", "Regulatory Affairs", "Legal Document Preparation", "Mediation"
  ],
  "Manufacturing & Engineering": [
    "CAD Design", "Quality Control", "Lean Manufacturing", "Supply Chain Management",
    "Production Planning", "Process Improvement", "Mechanical Engineering", "Electrical Engineering",
    "Industrial Design", "Robotics", "AutoCAD", "3D Modeling", "Product Development"
  ],
  "Human Resources": [
    "Recruitment", "Employee Relations", "Benefits Administration", "HRIS Management",
    "Performance Management", "Training & Development", "Compensation Analysis", 
    "Workforce Planning", "Talent Acquisition", "Succession Planning", "HR Compliance",
    "Employee Engagement", "Diversity & Inclusion", "HR Analytics"
  ],
  "Retail": [
    "Sales Associate Skills", "Visual Merchandising", "Inventory Management", "POS Systems",
    "Customer Service", "Retail Management", "Loss Prevention", "Product Knowledge",
    "Merchandising", "Category Management", "Retail Analytics", "E-commerce", "Upselling"
  ],
  "Media & Entertainment": [
    "Content Creation", "Video Production", "Audio Engineering", "Photography",
    "Script Writing", "Storyboarding", "Digital Animation", "Post-Production",
    "Broadcasting", "Media Planning", "Social Media Content", "Film Direction",
    "Sound Design", "Lighting Design", "Editing"
  ],
  "Real Estate": [
    "Property Management", "Real Estate Sales", "Leasing", "CRM Usage", 
    "Market Analysis", "Property Valuation", "Contract Negotiation", "Client Relations",
    "Property Listing", "Real Estate Marketing", "Mortgage Financing", "Real Estate Law",
    "Commercial Real Estate", "Residential Property Management"
  ],
  "Construction": [
    "Project Management", "Blueprint Reading", "Estimating", "Safety Compliance",
    "Building Codes", "Construction Supervision", "Quality Control", "Contract Administration",
    "Cost Control", "Scheduling", "CAD", "Site Planning", "Structural Analysis",
    "Sustainable Construction", "Heavy Equipment Operation"
  ],
  "Agriculture": [
    "Crop Management", "Livestock Management", "Farm Equipment Operation", "Irrigation Systems",
    "Pest Management", "Soil Conservation", "Harvest Planning", "Agricultural Technology",
    "Sustainable Farming", "Organic Certification", "Animal Husbandry", "Agricultural Economics",
    "Food Safety", "Supply Chain Management", "Agricultural Research"
  ],
  "Public Service & Government": [
    "Policy Analysis", "Public Administration", "Grant Writing", "Community Outreach",
    "Program Management", "Regulatory Compliance", "Budget Management", "Legislative Process",
    "Public Speaking", "Crisis Management", "Constituent Services", "Public Health",
    "Environmental Policy", "Urban Planning", "Emergency Management"
  ],
  "Transportation & Logistics": [
    "Supply Chain Management", "Fleet Management", "Logistics Planning", "Route Optimization",
    "Inventory Control", "Shipping Coordination", "Transportation Management Systems",
    "Freight Forwarding", "Import/Export Procedures", "Warehouse Management",
    "Distribution Planning", "Customs Clearance", "Transportation Regulations"
  ],
  "Energy & Utilities": [
    "Energy Management", "Renewable Energy", "Grid Operation", "Utility Regulation",
    "Power Distribution", "Energy Efficiency", "Environmental Compliance", "Safety Protocols",
    "Project Development", "Energy Analytics", "Smart Grid Technology", "Solar/Wind Operations",
    "Utility Maintenance", "Natural Gas Operations", "Water Treatment"
  ],
  "Non-Profit & NGO": [
    "Program Development", "Fundraising", "Grant Management", "Volunteer Coordination",
    "Donor Relations", "Non-Profit Administration", "Advocacy", "Community Engagement",
    "Strategic Planning", "Impact Assessment", "Board Relations", "International Development",
    "Social Service Delivery", "Charity Regulations", "Corporate Partnerships"
  ],
  "Biotechnology & Pharmaceuticals": [
    "Laboratory Techniques", "Clinical Trials", "R&D", "Regulatory Affairs",
    "Quality Assurance", "GMP Compliance", "Pharmaceutical Production", "Drug Development",
    "Biostatistics", "Medical Writing", "Pharmacology", "Molecular Biology",
    "Biochemistry", "Analytical Chemistry", "Manufacturing Process Validation"
  ],
  "Other": [] // This allows fully custom skill selection
};
        
        // Global variables
        window.newProfileImage = null;
        window.currentProfileImageURL = 'default-profile.jpg';
        window.defaultProfileImageURL = 'default-profile.jpg';
        window.customSkills = [];

        // Authentication check
        function checkAuthentication() {
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    console.log('User is signed in', user);
                    document.getElementById('navbar-username').textContent = user.email;
                    loadUserProfile(user);
                } else {
                    console.log('No user is signed in');
                    window.location.href = 'login.html';
                }
            });
        }

        // Load user profile
        function loadUserProfile(user) {
            const userId = user.uid;
            const database = firebase.database();
            
            database.ref('userinfo/' + userId).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        // Populate view mode
                        document.getElementById('firstname').textContent = userData.firstname || '';
                        document.getElementById('lastname').textContent = userData.lastname || '';
                        document.getElementById('email').textContent = userData.email || user.email;
                        document.getElementById('location').textContent = userData.location || 'Not specified';
                        document.getElementById('industry').textContent = userData.industry || 'Not specified';
                        
                        // Handle skills
                        if (userData.skills && userData.skills.length > 0) {
                            const allSkills = [...(userData.skills || []), ...(userData.customSkills || [])];
                            document.getElementById('skills-display').textContent = allSkills.join(', ');
                        } else {
                            document.getElementById('skills-display').textContent = 'None selected';
                        }
                        
                        // Handle profile image
                        if (userData.profileImageURL) {
                            document.getElementById('profile-image').src = userData.profileImageURL;
                            document.getElementById('edit-profile-image').src = userData.profileImageURL;
                            document.getElementById('navbar-profile-img').src = userData.profileImageURL;
                            window.currentProfileImageURL = userData.profileImageURL;
                        }
                        
                        // Populate edit mode
                        document.getElementById('edit-firstname').value = userData.firstname || '';
                        document.getElementById('edit-lastname').value = userData.lastname || '';
                        document.getElementById('edit-location').value = userData.location || '';
                        
                        if (userData.industry) {
                            document.getElementById('edit-industry').value = userData.industry;
                        }
                        
                        // Load custom skills
                        if (userData.customSkills && userData.customSkills.length > 0) {
                            window.customSkills = userData.customSkills;
                            updateCustomSkillsDisplay();
                        }
                    }
                })
                .catch((error) => {
                    console.error('Error loading user profile:', error);
                });
        }

        // Initialize skills select options
        function initializeSkills() {
            // Populate industry dropdown
            const industrySelect = document.getElementById('edit-industry');
            industrySelect.innerHTML = '<option value="">Select your industry</option>';
            
            Object.keys(industrySkills).forEach(industry => {
                const option = document.createElement('option');
                option.value = industry;
                option.textContent = industry;
                industrySelect.appendChild(option);
            });
        }

        // Toggle between view and edit modes
        function toggleEditMode(showEdit) {
            if (showEdit) {
                document.getElementById('view-mode').classList.add('hidden');
                document.getElementById('edit-mode').classList.remove('hidden');
            } else {
                document.getElementById('view-mode').classList.remove('hidden');
                document.getElementById('edit-mode').classList.add('hidden');
            }
        }

        // Save user info
        function saveUserInfo() {
            // Get the industry value
            const industry = document.getElementById('edit-industry').value;
            
            // Get all the standard selected skills
            const selectedSkills = [];
            const checkboxes = document.querySelectorAll('.skill-checkbox');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedSkills.push(checkbox.value);
                }
            });
            
            // Add custom skills to the selected skills
            const allSkills = [...selectedSkills, ...window.customSkills];
            
            const user = firebase.auth().currentUser;
            const firstName = document.getElementById('edit-firstname').value.trim();
            const lastName = document.getElementById('edit-lastname').value.trim();
            const location = document.getElementById('edit-location').value.trim();
            
            // Validate
            if (!firstName || !lastName) {
                document.getElementById('save-message').className = 'text-red-400 text-center font-medium';
                document.getElementById('save-message').innerHTML = 'Please provide both first and last name.';
                return;
            }
            
            if (!user) {
                document.getElementById('save-message').className = 'text-red-400 text-center font-medium';
                document.getElementById('save-message').innerHTML = 'You must be logged in to save profile information.';
                return;
            }
            
            document.getElementById('save-message').className = 'text-gray-400 text-center italic';
            document.getElementById('save-message').innerHTML = 'Saving your profile...';
            
            const userId = user.uid;
            
            // Handle profile image logic
            if (window.newProfileImage) {
                if (window.newProfileImage === 'remove') {
                    // User wants to remove their profile image
                    handleProfileUpdateEnhanced(userId, firstName, lastName, allSkills, window.defaultProfileImageURL, location, industry);
                } else {
                    // Upload the new image
                    const storage = firebase.storage();
                    const storageRef = storage.ref();
                    const profileImageRef = storageRef.child(`profile_images/${userId}`);
                    
                    document.getElementById('save-message').innerHTML = 'Uploading image...';
                    
                    profileImageRef.put(window.newProfileImage).then(snapshot => {
                        return snapshot.ref.getDownloadURL();
                    }).then(downloadURL => {
                        handleProfileUpdateEnhanced(userId, firstName, lastName, allSkills, downloadURL, location, industry);
                    }).catch(error => {
                        console.error('Error uploading image:', error);
                        document.getElementById('save-message').className = 'text-red-400 text-center font-medium';
                        document.getElementById('save-message').innerHTML = 'Error uploading image: ' + error.message;
                    });
                }
            } else {
                // No new image, just update the other profile info
                handleProfileUpdateEnhanced(userId, firstName, lastName, allSkills, window.currentProfileImageURL, location, industry);
            }
        }

        // Function to handle the enhanced profile update (including industry and custom skills)
        function handleProfileUpdateEnhanced(userId, firstName, lastName, skills, profileImageURL, location, industry) {
            const database = firebase.database();
            const saveMessage = document.getElementById('save-message');
            
            // Create userinfo entry with additional fields
            const userInfo = {
                firstname: firstName,
                lastname: lastName,
                email: firebase.auth().currentUser.email,
                location: location,
                industry: industry,
                skills: skills.filter(skill => !window.customSkills.includes(skill)), // Regular skills
                customSkills: window.customSkills, // Custom skills separately
                profileImageURL: profileImageURL,
                lastUpdated: new Date().toISOString()
            };
            
            // Save to userinfo table
            database.ref('userinfo/' + userId).set(userInfo)
                .then(() => {
                    console.log('User info saved successfully');
                    saveMessage.className = 'text-green-400 text-center font-medium';
                    saveMessage.innerHTML = 'Profile saved successfully!';
                    
                    // Update current URL reference
                    window.currentProfileImageURL = profileImageURL;
                    
                    // Update the view mode
                    document.getElementById('firstname').textContent = firstName;
                    document.getElementById('lastname').textContent = lastName;
                    document.getElementById('location').textContent = location || 'Not specified';
                    document.getElementById('industry').textContent = industry || 'Not specified';
                    document.getElementById('skills-display').textContent = 
                        skills.length > 0 ? skills.join(', ') : 'None selected';
                    document.getElementById('profile-image').src = profileImageURL;
                    document.getElementById('navbar-profile-img').src = profileImageURL;
                    
                    // Reset new image
                    window.newProfileImage = null;
                    
                    // Switch back to view mode after a short delay
                    setTimeout(() => {
                        toggleEditMode(false);
                    }, 1500);
                })
                .catch((error) => {
                    console.error('Error saving user info:', error);
                    saveMessage.className = 'text-red-400 text-center font-medium';
                    saveMessage.innerHTML = 'Error saving profile: ' + error.message;
                });
        }

        // Function to enhance the user profile page
        function enhanceUserProfilePage() {
            // Add industry selection to the edit form after location
            const locationDiv = document.querySelector('#edit-mode label[for="edit-location"]').parentNode;
            
            // Create industry selection
            const industryDiv = document.createElement('div');
            industryDiv.innerHTML = `
                <label for="edit-industry" class="block text-sm font-medium text-gray-300 mb-1">Industry</label>
                <select id="edit-industry" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                <option value="">Select your industry</option>
                ${Object.keys(industrySkills).map(industry => 
                    `<option value="${industry}">${industry}</option>`
                ).join('')}
                </select>
            `;
            
            // Insert after location
            locationDiv.insertAdjacentElement('afterend', industryDiv);
            
            // Add custom skills input after the skills container
            const skillsContainer = document.getElementById('skills-container');
            const customSkillsDiv = document.createElement('div');
            customSkillsDiv.className = 'mt-4';
            customSkillsDiv.innerHTML = `
                <label for="custom-skill" class="block text-sm font-medium text-gray-300 mb-1">Add Custom Skill</label>
                <div class="flex gap-2">
                <input type="text" id="custom-skill" placeholder="Enter a skill not listed above" 
                    class="flex-grow p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                <button id="add-custom-skill" 
                    class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors">
                    Add
                </button>
                </div>
                <div id="custom-skills-container" class="flex flex-wrap gap-2 mt-3"></div>
            `;
            
            skillsContainer.insertAdjacentElement('afterend', customSkillsDiv);
            
            // Initialize custom skills array
            window.customSkills = [];
            
            // Event handling for industry change
            document.getElementById('edit-industry').addEventListener('change', checkIndustryAndProvideSkills);
            
            // Event handling for custom skill addition
            document.getElementById('add-custom-skill').addEventListener('click', addCustomSkill);
            
            // Also add industry to the view mode
            const locationViewDiv = document.querySelector('#view-mode label:contains("Preferred Location")').parentNode;
            const industryViewDiv = document.createElement('div');
            industryViewDiv.innerHTML = `
                <label class="block text-sm font-medium text-gray-300 mb-1">Industry</label>
                <div id="industry" class="p-3 bg-gray-700 rounded-md border border-gray-600">Not specified</div>
            `;
            locationViewDiv.insertAdjacentElement('afterend', industryViewDiv);
        }

        // Function to check the industry selection and provide skill options
        function checkIndustryAndProvideSkills() {
            // Get the selected industry
            const industrySelect = document.getElementById('edit-industry');
            const selectedIndustry = industrySelect.value;
            
            // Get the skills container
            const skillsContainer = document.getElementById('skills-container');
            
            // Clear previous skills
            skillsContainer.innerHTML = '';
            
            // If no industry is selected, show a message
            if (!selectedIndustry) {
                skillsContainer.innerHTML = '<p class="text-gray-400 italic">Please select an industry to view related skills</p>';
                return;
            }
            
            // Get the skills for the selected industry
            const skills = industrySkills[selectedIndustry] || [];
            
            // If this is the "Other" industry or no skills are found, show a message
            if (selectedIndustry === "Other" || skills.length === 0) {
                skillsContainer.innerHTML = '<p class="text-gray-400 italic">Add your custom skills using the form below</p>';
                return;
            }
            
            // Create skill checkboxes and labels
            skills.forEach((skill, index) => {
                // Create the checkbox input
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `skill-${index}`;
                checkbox.className = 'hidden skill-checkbox';
                checkbox.value = skill;
                
                // Create the label
                const label = document.createElement('label');
                label.htmlFor = `skill-${index}`;
                label.className = 'inline-block px-3 py-2 bg-gray-700 text-gray-300 rounded-full border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors skill-label mr-2 mb-2';
                label.textContent = skill;
                
                // Add event listener to toggle active class when checkbox is clicked
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        label.classList.remove('bg-gray-700', 'text-gray-300', 'border-gray-600');
                        label.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    } else {
                        label.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                        label.classList.add('bg-gray-700', 'text-gray-300', 'border-gray-600');
                    }
                });
                
                // Add to the skills container
                skillsContainer.appendChild(checkbox);
                skillsContainer.appendChild(label);
            });
            
            // Check if user already has selected skills and mark them
            loadUserSelectedSkills(selectedIndustry);
        }

        // Function to load and check previously selected skills
        function loadUserSelectedSkills(industry) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            const userId = user.uid;
            const database = firebase.database();
            
            database.ref('userinfo/' + userId).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val();
                    if (userData && userData.skills && userData.skills.length > 0) {
                        // Get all checkbox elements
                        const checkboxes = document.querySelectorAll('.skill-checkbox');
                        
                        // Check each box if the skill is in the user's selected skills
                        checkboxes.forEach(checkbox => {
                            if (userData.skills.includes(checkbox.value)) {
                                checkbox.checked = true;
                                
                                // Update the label styling
                                const label = document.querySelector(`label[for="${checkbox.id}"]`);
                                if (label) {
                                    label.classList.remove('bg-gray-700', 'text-gray-300', 'border-gray-600');
                                    label.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                                }
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error("Error loading user skills:", error);
                });
        }

        // Function to add a custom skill
        function addCustomSkill() {
            const customSkillInput = document.getElementById('custom-skill');
            const skill = customSkillInput.value.trim();
            
            if (!skill) {
                return;
            }
            
            // Check if this skill already exists in the custom skills
            if (window.customSkills.includes(skill)) {
                alert('This skill is already in your list.');
                return;
            }
            
            // Add to custom skills array
            window.customSkills.push(skill);
            customSkillInput.value = '';
            
            // Update the display
            updateCustomSkillsDisplay();
        }

        // Function to update the custom skills display
        function updateCustomSkillsDisplay() {
            const customSkillsContainer = document.getElementById('custom-skills-container');
            customSkillsContainer.innerHTML = '';
            
            window.customSkills.forEach((skill, index) => {
                const skillTag = document.createElement('div');
                skillTag.className = 'inline-flex items-center px-3 py-1 bg-indigo-600 text-white rounded-full';
                skillTag.innerHTML = `
                ${skill}
                <button type="button" class="ml-2 text-white hover:text-red-300" data-index="${index}">
                    <i class="fas fa-times"></i>
                </button>
                `;
                
                // Add event listener to remove skill
                skillTag.querySelector('button').addEventListener('click', function() {
                    const index = Number(this.getAttribute('data-index'));
                    window.customSkills.splice(index, 1);
                    updateCustomSkillsDisplay
                    // Function to update the custom skills display (continued)
    updateCustomSkillsDisplay();
});

customSkillsContainer.appendChild(skillTag);
});
}

// Function to handle logout
function handleLogout() {
    firebase.auth().signOut().then(function() {
        console.log('User signed out');
        window.location.href = 'login.html';
    }).catch(function(error) {
        console.error('Error signing out:', error);
    });
}

// Function to handle profile image changes
function handleProfileImage() {
    // Add event listener for the change image button
    document.getElementById('change-image-button').addEventListener('click', function() {
        document.getElementById('profile-image-input').click();
    });
    
    // Add event listener for the file input
    document.getElementById('profile-image-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Check file size (limit to 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('File size should not exceed 2MB');
                return;
            }
            
            // Check file type
            if (!file.type.match('image.*')) {
                alert('Only image files are allowed');
                return;
            }
            
            // Store the file for upload later
            window.newProfileImage = file;
            
            // Display the selected image
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('edit-profile-image').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Add event listener for the remove image button
    document.getElementById('remove-image-button').addEventListener('click', function() {
        document.getElementById('edit-profile-image').src = window.defaultProfileImageURL;
        window.newProfileImage = 'remove';
    });
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is authenticated
    checkAuthentication();
    
    // Initialize skills options
    initializeSkills();
    
    // Setup event listeners
    document.getElementById('edit-button').addEventListener('click', function() {
        toggleEditMode(true);
    });
    
    document.getElementById('cancel-button').addEventListener('click', function() {
        toggleEditMode(false);
        document.getElementById('edit-profile-image').src = window.currentProfileImageURL;
        window.newProfileImage = null;
    });
    
    document.getElementById('save-button').addEventListener('click', saveUserInfo);
    document.getElementById('logout-button').addEventListener('click', handleLogout);
    
    // Handle industry change
    document.getElementById('edit-industry').addEventListener('change', function() {
        // Update skills based on selected industry
        const industry = this.value;
        const skillsContainer = document.getElementById('skills-container');
        
        // Clear existing skills
        skillsContainer.innerHTML = '';
        
        // If an industry is selected, populate skills
        if (industry && industrySkills[industry]) {
            industrySkills[industry].forEach((skill, index) => {
                const skillDiv = document.createElement('div');
                skillDiv.className = 'skill-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `skill-${index}`;
                checkbox.className = 'skill-checkbox hidden';
                checkbox.value = skill;
                
                const label = document.createElement('label');
                label.htmlFor = `skill-${index}`;
                label.className = 'inline-block px-3 py-2 bg-gray-700 text-gray-300 rounded-full border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors skill-label';
                label.textContent = skill;
                
                // Add event listener for styling changes
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        label.classList.remove('bg-gray-700', 'text-gray-300', 'border-gray-600');
                        label.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    } else {
                        label.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                        label.classList.add('bg-gray-700', 'text-gray-300', 'border-gray-600');
                    }
                });
                
                skillsContainer.appendChild(checkbox);
                skillsContainer.appendChild(label);
            });
        } else if (industry === 'Other') {
            // For "Other" category, show a message
            skillsContainer.innerHTML = '<p class="text-gray-400 italic">Add your custom skills below</p>';
        } else {
            // No industry selected
            skillsContainer.innerHTML = '<p class="text-gray-400 italic">Select an industry to see related skills</p>';
        }
    });
    
    // Handle custom skills input
    document.getElementById('add-custom-skill').addEventListener('click', function() {
        const customSkillInput = document.getElementById('custom-skill');
        const skill = customSkillInput.value.trim();
        
        if (!skill) return;
        
        if (window.customSkills.includes(skill)) {
            alert('This skill is already in your list');
            return;
        }
        
        window.customSkills.push(skill);
        customSkillInput.value = '';
        updateCustomSkillsDisplay();
    });
    
    // Setup profile image handlers
    handleProfileImage();
});
</script>
</body>
</html>